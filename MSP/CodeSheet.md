# 实验练习 (Lab Exercises) 🧪

---

## Lab1: 定时器中断 LED 闪烁

使用定时中断，编写一个程序，实现如下功能：

1.  初始时，Green LED 以大约 4 秒为周期慢速闪烁；
2.  当按下 PUSH2 时，Green LED 以大约 200 毫秒为周期快速闪烁；
3.  松开 PUSH2 时，Green LED 恢复以 4 秒为周期慢速闪烁。

实验在编程时主要涉及以下几个方面：

1.  添加定时器相关的源文件 `Timer.cpp` 和 `Timer.h` (代码由课程组提供)
2.  在 `setup()` 函数中调用 `SetTimer()` 设置定时器中断服务程序及定时周期
3.  在定时器中断服务程序中实现根据 PUSH2 状态来控制闪烁周期

---

## Lab2: 饮水机 (WaterDispenser) 💧

饮水机是我们生活中常见的家用设备。假设一个简易的饮水机有两个按键：童锁按键和热水按键。

**按键功能说明：**

1.  **童锁按键 (PUSH1)：**

    - 平时“童锁按键”处于 **锁定状态 (locked state)**。
    - 长按“童锁按键”3 秒后进入 **解锁状态 (unlocked state)**。
    - 如果“童锁按键”处于解锁状态，3 秒内没有按下“热水按键”，“童锁按键”回到 **锁定状态**。

2.  **热水按键 (PUSH2)：**
    - “童锁按键”处于 **锁定状态** 时，按下“热水按键”不起作用（不放水）。
    - “童锁按键”处于 **解锁状态** 时，按“热水按键”（按键释放有效）进入 **放水状态 (dispensing state)**，开始放水。
    - 处于 **放水状态** 时，再次按“热水按键”（按键释放有效），停止放热水，“童锁按键”回到 **锁定状态**。
    - 处于 **放水状态** 时，按“童锁按键”不起作用。
    - 在 **解锁状态** 时，长按“热水按键”超过 3 秒不放，不会自动回到“锁定状态”，按“童锁按键”也不起作用。

**程序设计：**

- PUSH1 为“童锁按键”。
- PUSH2 为“热水按键”。
- **锁定状态 (Locked state):** Red LED 亮。
- **解锁状态 (Unlocked state):** Red LED 灭。
- **放水状态 (Dispensing state):** Green LED 亮。

请设计程序，模拟饮水机的工作。

---

## WaterDispenserExact: 更精确的计时

修改 WaterDispenser 程序，将定时中断改为每 **10ms** 一次，以提高精度。

---

## WaterDispenserPlus1: 热水按键双击停止

为 WaterDispenser 程序增加以下功能：

- 处于 **放水状态 (dispensing state)** 时，**双击 (double-click)** 热水按键 (PUSH2)，停止放热水，“童锁按键”回到 **锁定状态 (locked state)**。
- **“双击”要求：** 第 1 次单击弹起与第 2 次单击弹起的时间间隔不超过 **300ms**。

---

## MultiWaterDispenserAddPause: 引入暂停状态 ⏸️

为 WaterDispenser 程序引入一个“暂停”状态 (状态 3 / State 3)。

- 如果机器正在放水（状态 2 / State 2）并且短暂按下 PUSH1，系统应进入状态 3。
- 在状态 3 下，Green LED 缓慢闪烁（例如，亮 1 秒，灭 1 秒），并且停止放水。
- 在状态 3 下按 PUSH2 则恢复放水（回到状态 2）。
- 在状态 3 下再次按 PUSH1 则返回“锁定“状态（状态 0 / State 0）。

---

## MultiWaterDispenserClean: 清洁循环 🧼

为 WaterDispenser 程序添加一个“清洁循环” (状态 5 / State 5)。

- 从“解锁“状态（状态 1 / State 1），如果 PUSH1 和 PUSH2 被同时按下（均为低电平）然后松开，机器进入“清洁”状态（状态 5）。
- 在此状态下，Green LED 点亮 **30 秒**，然后机器自动返回“锁定“状态（状态 0 / State 0）。
- 在清洁循环期间，其他按键操作均无效。

---

## MultiWaterDispenserError: 引入错误状态 ⚠️

为 WaterDispenser 程序添加一个“错误“状态 (状态 4 / State 4)。

- 例如，如果检测到 PUSH1 和 PUSH2 同时被按下超过 **1 秒**，机器进入状态 4。
- 在状态 4 下，Red LED 和 Green LED 一起快速闪烁。
- 机器只能通过完全复位（或例如 5 秒后返回状态 0 / State 0，或其他特定操作）来退出此状态。

---

## MultiWaterDispenserPre: 引入预冲洗模式 🚿

在 WaterDispenser 程序中实现一个“预冲洗模式”。

- 要进入此模式，从“锁定“状态（状态 0 / State 0）开始，长按 PUSH2 达 **5 秒**。
- 在预冲洗模式下，Green LED 点亮，系统模拟放水 **5 秒**钟，然后自动返回“锁定“状态。
- 在预冲洗模式期间，PUSH1 应不起作用。
